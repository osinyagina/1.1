# Документация к проекту

#### Как запустить проект:	
1. Запустите через терминал файл run_scripts.sh

#### Исходные данные: 

| Field Name             | Type      | Nullable | Description                                  |
|------------------------|-----------|----------|----------------------------------------------|
| event_id               | string    | true     | Уникальный идентификатор события             |
| event_timestamp        | string    | true     | Временная метка события                      |
| event_type             | string    | true     | Тип события (например, клик, просмотр)       |
| page_url               | string    | true     | Полный URL страницы, на которой произошло событие |
| page_url_path          | string    | true     | Путь URL страницы без доменного имени        |
| referer_url            | string    | true     | URL источника трафика                        |
| referer_url_scheme     | string    | true     | Протокол URL источника (например, http, https) |
| referer_url_port       | long      | true     | Порт URL источника                           |
| referer_medium         | string    | true     | Тип источника трафика (например, реферал, прямой) |
| utm_medium             | string    | true     | UTM-метка для идентификации средства маркетинга |
| utm_source             | string    | true     | UTM-метка источника трафика                  |
| utm_content            | string    | true     | UTM-метка для определения рекламного контента |
| utm_campaign           | string    | true     | UTM-метка названия кампании                  |
| click_id               | string    | true     | Идентификатор клика для отслеживания         |
| geo_latitude           | double    | true     | Широта географического положения             |
| geo_longitude          | double    | true     | Долгота географического положения            |
| geo_country            | string    | true     | Страна географического положения             |
| geo_timezone           | string    | true     | Часовой пояс географического положения       |
| geo_region_name        | string    | true     | Название региона географического положения   |
| ip_address             | string    | true     | IP-адрес пользователя                        |
| browser_name           | string    | true     | Название веб-браузера пользователя           |
| browser_user_agent     | string    | true     | Строка User-Agent веб-браузера               |
| browser_language       | string    | true     | Предпочтительный язык веб-браузера           |
| os                     | string    | true     | Операционная система устройства              |
| os_name                | string    | true     | Название операционной системы                |
| os_timezone            | string    | true     | Часовой пояс операционной системы            |
| device_type            | string    | true     | Тип устройства (например, мобильное, десктоп) |
| device_is_mobile       | boolean   | true     | Признак мобильного устройства                |
| user_custom_id         | string    | true     | Пользовательский идентификатор               |
| user_domain_id         | string    | true     | Идентификатор доменной зоны пользователя     |


#### Структура хранилища

- На staging-слой данные выгружаются as-is
- Структура dds слоя имеет тип "снежинка", был выбран подход Билла Инмана

> **Плюсы подхода Билла Инмона к хранилищам данных**:
> 
> 1. **Высокая целостность данных**: Нормализация данных уменьшает избыточность и повышает их целостность.
> 2. **Единый источник истины**: Интегрированное хранилище обеспечивает единую, консистентную основу для аналитики и отчетности.
> 3. **Подробный исторический анализ**: Хранение исторических данных позволяет проводить глубокий анализ за длительные временные периоды.
> 4. **Гибкость в создании Data Marts**: Возможность создавать специализированные Data Marts на основе централизованного хранилища.
> 5. **Подходит для больших и сложных систем**: Хорошо масштабируется и подходит для комплексных корпоративных систем.

| Table Name       | Description                                         |
|------------------|-----------------------------------------------------|
| `dds.oss`        | Содержит информацию об операционных системах.       |
| `dds.browsers`   | Содержит информацию о веб-браузерах.                |
| `dds.geo_subjects` | Содержит географическую информацию (страны, регионы). |
| `dds.utms`       | Содержит информацию о маркетинговых UTM-метках.     |
| `dds.referers`   | Содержит информацию об источниках переходов на сайт. |
| `dds.pages`      | Содержит информацию о веб-страницах.                |
| `dds.users`      | Содержит информацию о пользователях.                |
| `dds.locations`  | Содержит информацию о геолокациях пользователей.    |
| `dds.timezones`  | Содержит информацию о часовых поясах.               |
| `dds.devices`    | Содержит информацию об устройствах пользователей.   |
| `dds.user_sessions` | Содержит информацию о сессиях пользователей.     |
| `dds.timestamps` | Содержит временные метки и связанные данные.        |
| `dds.site_events`| Содержит информацию о событиях на сайте.            |

- На слое cdm расположены витрины для анализа и визуализации данных

> Признаком совершения покупки считаем переход на страницу 'confirmation'


**cdm.event_by_ts** - витрина, отображающая количество событий и покупок в разрезе каждого часа

| Поле         | Тип        | Описание                      |
|--------------|------------|-------------------------------|
| id           | serial4    | Уникальный идентификатор записи|
| ts_timestamp | timestamp  | Временная метка события        |
| ts_year      | int2       | Год события                   |
| ts_month     | int2       | Месяц события                 |
| ts_day       | int2       | День события                  |
| ts_hour      | int2       | Час события                   |
| event_num    | int4       | Количество событий            |
| purchase_num | int4       | Количество покупок            |

**cdm.event_by_ts_bd** -  расширенная версия предыдущей витрины с дополнительной фильтрацией по типу девайса и браузеру

| Поле             | Тип          | Описание                                      |
|------------------|--------------|-----------------------------------------------|
| id               | serial4      | Уникальный идентификатор записи               |
| ts_timestamp     | timestamp    | Временная метка события                        |
| ts_year          | int2         | Год события                                   |
| ts_month         | int2         | Месяц события                                 |
| ts_day           | int2         | День события                                  |
| ts_hour          | int2         | Час события                                   |
| browser_name     | varchar(32)  | Название браузера                             |
| device_type      | varchar(16)  | Тип устройства                                |
| device_is_mobile | boolean      | Признак мобильного устройства                 |
| event_num        | int4         | Количество событий                            |
| purchase_num     | int4         | Количество покупок                            |

**cdm.utm_source_share** -  витрина, показывающая эффективность маркетинговых активностей

| Поле         | Тип          | Описание                              |
|--------------|--------------|---------------------------------------|
| ts_timestamp | timestamp    | Временная метка события                |
| ts_year      | int2         | Год события                           |
| ts_month     | int2         | Месяц события                         |
| ts_day       | int2         | День события                          |
| ts_hour      | int2         | Час события                           |
| utm_source   | varchar(128) | Источник трафика UTM                  |
| user_count   | int4         | Количество пользователей              |

**cdm.top_page_by_sale** - витрина с информацией о страницах, сразу после посещения которых пользователи совершают покупку

> Исключаем страницы 'payment', 'cart'

| Поле         | Тип         | Описание                      |
|--------------|-------------|-------------------------------|
| page_url     | varchar(128)| URL страницы                  |
| purchase_num | int         | Количество покупок на странице|

**top_page_by_sale_ts** - расширенная версия предыдущей витрины с учетом даты и времени события

| Поле         | Тип         | Описание                      |
|--------------|-------------|-------------------------------|
| ts_timestamp | timestamp   | Временная метка события        |
| ts_year      | int2        | Год события                   |
| ts_month     | int2        | Месяц события                 |
| ts_day       | int2        | День события                  |
| ts_hour      | int2        | Час события                   |
| page_url     | varchar(128)| URL страницы                  |
| purchase_num | int         | Количество покупок на странице|






